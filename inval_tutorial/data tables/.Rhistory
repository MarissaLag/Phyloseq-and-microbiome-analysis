gam.check(gam_clams)
gam_clams <- gam(log(Tonnes +1) ~ s(Year, k = 5),
data = Data_long_clams,
family = guassian())
gam_clams <- gam(log(Tonnes +1) ~ s(Year, k = 5),
data = Data_long_clams,
family = Gaussian())
gam_clams <- gam(log(Tonnes +1) ~ s(Year, k = 5),
data = Data_long_clams,
family = poisson())
gam.check(gam_clams)
gam_clams <- gam(log(Tonnes) ~ s(Year, k = 5),
data = Data_long_clams,
family = poisson())
gam_clams <- gam(log(Tonnes) ~ s(Year, k = 3),
data = Data_long_clams,
family = poisson())
gam.check(gam_clams)
gam_clams <- gam(log(Tonnes +1) ~ s(Year, k = 3),
data = Data_long_clams)
gam.check(gam_clams)
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
gam_clams <- gam(log(Tonnes) ~ s(Year, k = 3),
data = Data_long_clams)
gam.check(gam_clams)
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
gam_clams <- gam(sqrt(Tonnes) ~ s(Year, k = 3),
data = Data_long_clams)
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
gam_clams <- gam(sqrt(Tonnes) ~ s(Year, k = 3),
data = Data_long_clams,
family = tw())
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
gam_clams <- gam(sqrt(Tonnes) ~ s(Year, k = 3),
data = Data_long_clams)
gam.check(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 3),
data = Data_long_clams)
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
summary(gam_clams)
library(survival)
library(survminer)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(emmeans)
library(readxl)
X2year_Va_challenge_results <- read_excel("~/Documents/PhD/PB2023/2year_Va_challenge_results.xlsx",
sheet = "R")
View(X2year_Va_challenge_results)
Data <- X2year_Va_challenge_results
head(Data)
surv_object = Surv(time=Data$Time, event=Data$Outcome)
surv_object
fit1 = survfit(surv_object~ Treatment, data=Data)
summary(fit1)
plot(fit1, xlab="Survival Time in Days", color = "Treatment",
ylab="% Surviving", yscale=100,
main="Survival Distribution (Overall)")
ggsurvplot(fit1, data=Data, pval = TRUE, legend = "bottom", legend.title="Treatment", font.legend =c(9,"plain","black"))
ggsurvplot(fit1, data = Data_HT, pval = TRUE, legend = "bottom", legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Control", "Va", "Va + WC"),
palette = color_palette, ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data, pval = TRUE, legend = "bottom", legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
# legend.labs = c("Control", "Va", "Va + WC"),
palette = color_palette, ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data, pval = TRUE, legend = "bottom", legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
#legend.labs = c("Control", "Va", "Va + WC"),
palette = color_palette, ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data, pval = TRUE, legend = "bottom", legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Control", "Bacterial Added", "Killed-Bacteria Added"),
palette = color_palette, ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
Data
fit1
ggsurvplot(fit1, data = Data, pval = TRUE, legend = "bottom", legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Control", "Bacterial Added", "Killed-Bacteria Added"),
palette = color_palette, ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data, pval = TRUE, legend = "bottom", legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Control", "Bacterial Added", "Killed-Bacteria Added"),
palette = color_palette, ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data, pval = TRUE, legend = "bottom", legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Control", "Bacteria Added", "Killed-Bacteria Added"),
palette = color_palette, ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
Data$Treatment
ggsurvplot(fit1, data=Data, pval = TRUE, legend = "bottom", legend.title="Treatment", font.legend =c(9,"plain","black"))
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Control", "Bacteria Added", "Killed-Bacteria Added"),
palette = c("black", "steelblue", "firebrick"),
ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Control", "Bacteria Added", "Killed-Bacteria Added"),
palette = c("grey", "orange", "lightgreen"),
ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Control", "Bacteria Added", "Killed-Bacteria Added"),
palette = c("grey", "orange", "#4DAF4A"),
ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Bacteria Added", "Control", "Killed-Bacteria Added"),
palette = c("grey", "orange", "#4DAF4A"),
ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Bacteria Added", "Control", "Killed-Bacteria Added"),
palette = c( "#4DAF4A","Control","orange"),
ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Bacteria Added", "Control", "Killed-Bacteria Added"),
palette = c( "#4DAF4A","Control","orange"),
ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Bacteria Added", "Control", "Killed-Bacteria Added"),
palette = c( "#4DAF4A","grey","orange"),
ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Bacteria Added", "Control", "Killed-Bacteria Added"),
palette = c( "#4DAF4A","grey","orange"),
ylim = c(0, 1),
conf.int = FALSE,
lwd = 1.5,
xlab = "Time (days)")
ggsurvplot(fit1, data = Data,
pval = TRUE,
legend = "bottom",
legend.title = "Treatment",
font.legend = c(12, "plain", "black"),
legend.labs = c("Bacteria Added", "Control", "Killed-Bacteria Added"),
palette = c( "#4DAF4A","grey","orange"),
ylim = c(0, 1),
conf.int = TRUE,
lwd = 1.5,
xlab = "Time (days)")
fit.coxph =coxph(Surv(Time,Outcome)~ Treatment,data=Data)
summary(fit.coxph)
plot <- ggforest(fit.coxph, data=Data, main = "Hazard ratio",
fontsize = 0.9,
noDigits = 2
)
Data$Treatment <- relevel(factor(Data$Treatment), ref = "Control")
fit.coxph =coxph(Surv(Time,Outcome)~ Treatment,data=Data)
summary(fit.coxph)
plot <- ggforest(fit.coxph, data=Data, main = "Hazard ratio",
fontsize = 0.9,
noDigits = 2
)
plot <- plot + theme(text = element_text(size = 12
))
plot
plot <- plot + theme(text = element_text(size = 14
))
plot
#Test proportional hazard assumption ----
ph_test <- cox.zph(fit.coxph)
ph_test
gam.check(gam_clams)
lm_clams <- lm(sqrt(Tonnes) ~ Year, data = Data_long_clams)
summary(lm_clams)
plot(lm_clams)
qqnorm(residuals(lm_clams))
plot(fitted(Mod5)~residuals(lm_clams))
plot(fitted(lm_clams)~residuals(lm_clams))
resid_panel(lm_clams)
lm_clams <- lm(log(Tonnes) ~ Year, data = Data_long_clams)
lm_clams <- lm(log(Tonnes +1) ~ Year, data = Data_long_clams)
resid_panel(lm_clams)
lm_clams <- lm((Tonnes) ~ Year, data = Data_long_clams)
resid_panel(lm_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 3),
data = Data_long_clams)
gam.check(gam_clams)
resid_panel(gam_clams)
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
appraise(gam_clams)  # from gratia package
library(graphia)
install.packages("gratia")
library(gratia)
appraise(gam_clams)  # from gratia package
draw(gam_model)
draw(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 3),
data = Data_long_clams,
family = tw())
gam.check(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 6),
data = Data_long_clams,
family = tw())
gam.check(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 8),
data = Data_long_clams,
family = tw())
gam.check(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 50),
data = Data_long_clams,
family = tw())
gam_clams <- gam(Tonnes ~ s(Year, k = 10),
data = Data_long_clams,
family = tw())
gam.check(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 9),
data = Data_long_clams,
family = tw())
gam.check(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 8),
data = Data_long_clams,
family = tw())
gam.check(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 9),
data = Data_long_clams,
family = tw())
gam.check(gam_clams)
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
appraise(gam_clams)  # from gratia package
draw(gam_clams)
gam_clams <- gam(Tonnes ~ s(Year, k = 9),
data = Data_long_clams)
gam.check(gam_clams)
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
gam_clams <- gam(Tonnes ~ s(Year, k = 9),
data = Data_long_clams,
family = tw())
simulation_output <- simulateResiduals(gam_clams)
plot(simulation_output)
summary(gam_clams)
#Mussels GAM ----
Data_long_mus <- Data_long %>%
filter(Product %in% c("Mussels"))
lm_mus <- lm((Tonnes) ~ Year, data = Data_long_mus)
summary(lm_mus)
plot(lm_mus)
qqnorm(residuals(lm_mus))
plot(fitted(lm_mus)~residuals(lm_mus))
resid_panel(lm_mus)
gam_mus <- gam(Tonnes ~ s(Year, k = 3),
data = Data_long_mus)
summary(gam_mus)
plot(gam_mus, shade = TRUE)
AIC(lm_mus, gam_mus)
par(mfrow = c(2, 2))
gam.check(gam_mus)
gam_mus <- gam(Tonnes ~ s(Year, k = 4),
data = Data_long_mus)
plot(gam_mus, shade = TRUE)
gam.check(gam_mus)
AIC(lm_mus, gam_mus)
simulation_output <- simulateResiduals(gam_mus)
plot(simulation_output)
gam_mus <- gam(Tonnes ~ s(Year, k = 4),
data = Data_long_mus,
family = tw())
simulation_output <- simulateResiduals(gam_mus)
plot(simulation_output)
gam.check(gam_mus)
gam_mus <- gam(Tonnes ~ s(Year, k = 5),
data = Data_long_mus,
family = tw())
gam.check(gam_mus)
gam_mus <- gam(Tonnes ~ s(Year, k = 6),
data = Data_long_mus,
family = tw())
gam.check(gam_mus)
gam_mus <- gam(Tonnes ~ s(Year, k = 7),
data = Data_long_mus,
family = tw())
gam.check(gam_mus)
gam_mus <- gam(Tonnes ~ s(Year, k = 8),
data = Data_long_mus,
family = tw())
gam.check(gam_mus)
simulation_output <- simulateResiduals(gam_mus)
plot(simulation_output)
AIC(lm_mus, gam_mus)
summary(gam_mus)
concurvity(gam_mus, full = TRUE) #issue
concurvity(gam_mus, full = TRUE)
concurvity(gam_clams, full = TRUE)
#Scallops GAM ----
Data_long_mus <- Data_long %>%
filter(Product %in% c("Scallops"))
#Scallops GAM ----
Data_long_scal <- Data_long %>%
filter(Product %in% c("Scallops"))
lm_mus <- lm((Tonnes) ~ Year, data = Data_long_scal)
lm_scal <- lm((Tonnes) ~ Year, data = Data_long_scal)
summary(lm_scal)
plot(lm_scal)
qqnorm(residuals(lm_scal))
plot(fitted(lm_scal)~residuals(lm_scal))
resid_panel(lm_scal)
gam_scal <- gam(Tonnes ~ s(Year, k = 8),
data = Data_long_scal,
family = tw())
summary(gam_scal)
plot(gam_scal, shade = TRUE)
plot(gam_scal, shade = TRUE)
AIC(lm_mus, gam_scal)
AIC(lm_scal, gam_scal)
par(mfrow = c(2, 2))
gam.check(gam_scal)
gam_scal <- gam(Tonnes ~ s(Year, k = 9),
data = Data_long_scal,
family = tw())
gam.check(gam_scal)
simulation_output <- simulateResiduals(gam_scal)
plot(simulation_output)
gam_scal <- gam(log(Tonnes +1) ~ s(Year, k = 9),
data = Data_long_scal,
family = tw())
gam.check(gam_scal)
simulation_output <- simulateResiduals(gam_scal)
plot(simulation_output)
concurvity(gam_mus, full = TRUE)
summary(gam_scal)
gam_scal <- gam((Tonnes) ~ s(Year, k = 9),
data = Data_long_scal,
family = tw())
simulation_output <- simulateResiduals(gam_scal)
plot(simulation_output)
gam_scal <- gam(log(Tonnes + 1) ~ s(Year, k = 9),
data = Data_long_scal,
family = tw())
summary(gam_scal)
simulation_output <- simulateResiduals(gam_scal)
plot(simulation_output)
par(mfrow = c(2, 2))
plot(gam_scal, shade = TRUE)
summary(gam_scal)
gam.check(gam_scal)
AIC(lm_scal, gam_scal)
gam_scal <- gam((Tonnes) ~ s(Year, k = 9),
data = Data_long_scal,
family = tw())
AIC(lm_scal, gam_scal)
ggplot(Data_long, aes(x = Year, y = Tonnes, color = `Species/Product`, fill = `Species/Product`, group = `Species/Product`)) +
geom_line() +
geom_ribbon(aes(ymin = 0, ymax = Tonnes), alpha = 0.5) +
scale_fill_npg() +
scale_color_npg() +
labs(title = "", x = "Year", y = "Production (Tonnes)") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 12),          # Increase x-axis label size
axis.text.y = element_text(size = 12),                                  # Increase y-axis label size
axis.title.x = element_text(size = 14, face = "bold"),                  # Increase x-axis title size and make bold
axis.title.y = element_text(size = 14, face = "bold"),                  # Increase y-axis title size and make bold
axis.line = element_line(size = 0.5),                                   # Make axis lines bolder
panel.grid = element_blank(),
legend.text = element_text(size = 14),
legend.title = element_text(size=14, face = "bold")
)
# Then in your ggplot:
ggplot(Data_long, aes(x = Year, y = Tonnes, color = `Species/Product`, fill = `Species/Product`, group = `Species/Product`)) +
geom_line() +
geom_ribbon(aes(ymin = 0, ymax = Tonnes), alpha = 0.5) +
geom_smooth(method = "gam", se = FALSE, linetype = "dashed", size = 1.5, alpha = 1) +
stat_poly_eq(
aes(label = paste("bold(", ..eq.label.., ")", "~~~", "bold(", ..rr.label.., ")")),
formula = y ~ x,
parse = TRUE,
size = 4.4,
label.x.npc = "left",
label.y.npc = "top"
) +
scale_x_continuous(
breaks = seq(min(Data_long$Year), max(Data_long$Year), by = 2)  # change 'by' to 1, 2, or 5 as needed
) +
scale_fill_npg() +
scale_color_npg() +
labs(title = "", x = "Year", y = "Production (Tonnes)") +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 12),
axis.text.y = element_text(size = 12),
axis.title.x = element_text(size = 14, face = "bold"),
axis.title.y = element_text(size = 14, face = "bold"),
axis.line = element_line(size = 0.5),
panel.grid = element_blank(),
legend.text = element_text(size = 14),
legend.title = element_text(size = 14, face = "bold")
)
Data_long_scal <- Data_long_scal %>%
mutate(Predicted = predict(gam_scal, type = "response"))
ggplot(Data_long_scal, aes(x = Year, y = Tonnes)) +
geom_point(color = "gray50") +
geom_line(aes(y = Predicted), color = "blue", size = 1.2) +
labs(title = "Observed vs GAM-predicted Scallop Production",
y = "Tonnes")
range(Data_long_scal$Predicted)
gam_oyster <- gam(Tonnes ~ s(Year, k = 3), data = Data_long_oyster)  # k = smoothness
summary(gam_oyster)
gam.check(gam_oyster)
simulation_output <- simulateResiduals(gam_oyster)
plot(simulation_output)
gam_oyster <- gam(Tonnes ~ s(Year, k = 3), data = Data_long_oyster,
family = tw())  # k = smoothness
summary(gam_oyster)
simulation_output <- simulateResiduals(gam_oyster)
plot(simulation_output)
gam.check(gam_oyster)
gam_oyster <- gam(Tonnes ~ s(Year, k = 3), data = Data_long_oyster)  # k = smoothness
plot(gam_oyster, shade = TRUE)
gam.check(gam_oyster)
simulation_output <- simulateResiduals(gam_oyster)
plot(simulation_output)
gam_oyster <- gam(log(Tonnes +1) ~ s(Year, k = 3), data = Data_long_oyster)  # k = smoothness
simulation_output <- simulateResiduals(gam_oyster)
plot(simulation_output)
gam_oyster <- gam(sqrt(Tonnes) ~ s(Year, k = 3), data = Data_long_oyster)  # k = smoothness
simulation_output <- simulateResiduals(gam_oyster)
plot(simulation_output)
gam_oyster <- gam(Tonnes ~ s(Year, k = 3), data = Data_long_oyster)  # k = smoothness
simulation_output <- simulateResiduals(gam_oyster)
plot(simulation_output)
Sam_all_samples_partial_rare_CSS <- readRDS("~/Documents/GitHub/Phyloseq and microbiome analysis/Old RDS files/Sam_all_samples_partial_rare_CSS.rds")
pseq <- Sam_all_samples_partial_rare_CSS
pseq@sam_data
pseq <- subset_samples(pseq, Organism %in% c("Water"))
pseq
#Quality check
any(taxa_sums(pseq) == 0)
pseq_filtered <- prune_taxa(taxa_sums(pseq) > 0, pseq)
any(taxa_sums(pseq_filtered) == 0)
pseq <- pseq_filtered
View(pseq@tax_table)
pseq <- Sam_all_samples_partial_rare_CSS
pseq
View(pseq@tax_table)
