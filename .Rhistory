setwd("C:/Users/maris/OneDrive/Documents/GitHub/Phyloseq and microbiome analysis")
Marissa_MU42022_rarefied_20231016 <- readRDS("~/GitHub/Phyloseq and microbiome analysis/Marissa_MU42022_rarefied_20231016.rds")
pseq <- Marissa_MU42022_rarefied_20231016
library("devtools")
library(phyloseq)
library(microbiome)
library(vegan)
OTU = pseq@otu_table
Tax = pseq@tax_table
Metadata = pseq@sam_data
Tree = pseq@phy_tree
pseq_filtered <- subset_samples(pseq, !Treatment %in% NA)
pseq_filtered <- subset_samples(pseq_filtered, !Genetics %in% NA)
Data <- data.frame(sample_data(pseq_filtered))
#Create matrix
Test_bray <- adonis2(Bray_dist ~ Type , data = Data)
Bray_dist <- ordinate(Data, method = "MDS", distance = "bray", weighted = TRUE)
Bray_dist <- ordinate(pseq_filtered, method = "MDS", distance = "bray", weighted = TRUE)
Test_bray <- adonis2(Bray_dist ~ Type , data = Data)
#Create matrix
Test_bray
Bray_dist
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
permanova <- adonis2(t(OTU) ~ Treatment*Age*Genetics,
data = pseq, permutations=999, method = "bray")
permanova <- adonis2(t(OTU) ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
Bray_dist<- phyloseq::distance(pseq_filtered, method = "bray", weighted = TRUE)
Sample_star <- data.frame(sample_data(pseq_filtered))
Test_bray<-adonis(Bray_dist ~ Treatment, data = Sample_star)
Test_bray<-adonis2(Bray_dist ~ Treatment, data = Sample_star)
pairwise.adonis(Bray_dist,Sample_star$Treatment)
pairwise.adonis2(Bray_dist,Sample_star$Treatment)
View(Test_bray)
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
View(permanova)
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
permanova
pairwise.adonis2(Data ~ Treatment, data = Data, strata = 'Genetics')
pair <- pairwise.adonis2(Data ~ Treatment, data = Data, strata = 'Genetics')
pair <- pairwise.adonis2(Data ~ Treatment, data = Data, strata = 'Genetics')
pair <- adonis_pairwise(Data ~ Treatment, data = Data, strata = 'Genetics')
permanova <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray", strata = Genetics)
permanova <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray", strata = 'Genetics')
permanova <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray", strata = pseq_filtered@sam_data$Genetics)
permanova_strata <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray", strata = pseq_filtered@sam_data$Genetics)
View(permanova_strata)
permanova <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray")
View(permanova)
set.seed(452)
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
View(permanova)
View(permanova)
permanova2 <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray")
permanova2
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
permanova
pseq_filtered
View(Data)
pseq_filtered
View(Data)
Bray_dist
View(Bray_dist)
View(Bray_dist)
Bray_dist<- phyloseq::distance(pseq_filtered, method = "bray", weighted = TRUE)
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
permanova
permanova2 <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray")
permanova2
permanova2 <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray")
permanova2
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
permanova
data(dune.env)
data(dune)
View(dune)
View(dune.env)
adonis2(dune ~ Management*A1, data = dune.env)
## overall tests
adonis2(dune ~ Management*A1, data = dune.env, by = NULL)
### Example of use with strata, for nested (e.g., block) designs.
dat <- expand.grid(rep=gl(2,1), NO3=factor(c(0,10)),field=gl(3,1) )
dat
Agropyron <- with(dat, as.numeric(field) + as.numeric(NO3)+2) +rnorm(12)/2
Schizachyrium <- with(dat, as.numeric(field) - as.numeric(NO3)+2) +rnorm(12)/2
total <- Agropyron + Schizachyrium
total
dotplot(total ~ NO3, dat, jitter.x=TRUE, groups=field,
type=c('p','a'), xlab="NO3", auto.key=list(columns=3, lines=TRUE) )
Y <- data.frame(Agropyron, Schizachyrium)
mod <- metaMDS(Y, trace = FALSE)
plot(mod)
### Ellipsoid hulls show treatment
with(dat, ordiellipse(mod, field, kind = "ehull", label = TRUE))
dune.env
### Spider shows fields
with(dat, ordispider(mod, field, lty=3, col="red"))
### Incorrect (no strata)
adonis2(Y ~ NO3, data = dat, permutations = 199)
## Correct with strata
with(dat, adonis2(Y ~ NO3, data = dat, permutations = 199, strata = field))
data(dune) #abundance
data(dune.env)
dune
View(dune)
Agropyron
Schizachyrium
dat <- expand.grid(rep=gl(2,1), NO3=factor(c(0,10)),field=gl(3,1) )
View(dat)
pseq_filtered
permanova_strata <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray", strata = pseq_filtered@sam_data$Genetics)
permanova_strata
permanova <- adonis2(Bray_dist ~ Treatment*Age*Genetics,
data = Data, permutations=999, method = "bray")
permanova
permanova_strata <- adonis2(Bray_dist ~ Genetics,
data = Data, permutations=999, method = "bray", strata = pseq_filtered@sam_data$Treatment)
permanova_strata
permanova_strata <- adonis2(Bray_dist ~ Age,
data = Data, permutations=999, method = "bray", strata = pseq_filtered@sam_data$Treatment)
permanova_strata
permanova_strata <- adonis2(Bray_dist ~ Age,
data = Data, permutations=999, method = "bray", strata = pseq_filtered@sam_data$Genetics)
permanova_strata
### Ellipsoid hulls show treatment
with(dat, ordiellipse(mod, field, kind = "ehull", label = TRUE))
### Spider shows fields
with(dat, ordispider(mod, field, lty=3, col="red"))
Y <- data.frame(Agropyron, Schizachyrium)
mod <- metaMDS(Y, trace = FALSE)
plot(mod)
### Ellipsoid hulls show treatment
with(dat, ordiellipse(mod, field, kind = "ehull", label = TRUE))
### Spider shows fields
with(dat, ordispider(mod, field, lty=3, col="red"))
### Ellipsoid hulls show treatment
with(Data, ordiellipse(mod, Treatment, kind = "ehull", label = TRUE))
View(dat)
Data
Data$Treatment <- sub("Control", 1, Data$Treatment)
Data
Data$Treatment <- sub("Control", 1, Data$Treatment)
Data$Treatment <- sub("Probiotics", 2, Data$Treatment)
Data$Treatment <- sub("Probiotics + HT", 3, Data$Treatment)
Data$Treatment <- sub("High temperature", 4, Data$Treatment)
Data
Data$Treatment <- sub("Control", 1, Data$Treatment)
Data$Treatment <- sub("Probiotics", 2, Data$Treatment)
Data$Treatment <- sub("Probiotics.+.HT", 3, Data$Treatment)
Data$Treatment <- sub("High temperature", 4, Data$Treatment)
Data
Data <- data.frame(sample_data(pseq_filtered))
Data
Data$Treatment <- sub("Control", 1, Data$Treatment)
Data$Treatment <- sub("Probiotics + HT", 3, Data$Treatment)
Data$Treatment <- sub("Probiotics", 2, Data$Treatment)
Data$Treatment <- sub("High temperature", 4, Data$Treatment)
Data
Data <- data.frame(sample_data(pseq_filtered))
Data$Treatment <- sub("Control", 1, Data$Treatment)
Data
Data$Treatment <- sub("Probiotics + HT", 3, Data$Treatment)
Data
Data$Treatment <- sub("Probiotics.+.HT", 3, Data$Treatment)
Data
Data$Treatment <- sub("Probiotics", 2, Data$Treatment)
Data$Treatment <- sub("High temperature", 4, Data$Treatment)
Data
Data$Age <- sub("Day 01", 1, Data$Age)
Data
Data$Age <- sub("Day 01", 1, Data$Age)
Data$Age <- sub("Day 03", 3, Data$Age)
Data$Age <- sub("Day 06", 6, Data$Age)
Data$Age <- sub("Day 15", 15, Data$Age)
Data$Age <- sub("Spat", 20, Data$Age)
Data
View(dat)
Data
View(Data)
dat <- expand.grid(Age=gl(5), Treatment=factor(c(1,2,3,4)),Genetics=factor(c(1,2,3,4)) )
replications <- c(11, 13, 11, 12, 20)
dat <- expand.grid(Age=gl(5, replications), Treatment=factor(c(1,2,3,4)),Genetics=factor(c(1,2,3,4)) )
level_counts <- table(dat$Age)
# Print the counts
print(level_counts)
permanova_strata <- adonis2(Bray_dist ~ Treatment,
data = Data, permutations=999, method = "bray", strata = pseq_filtered@sam_data$Genetics)
permanova_strata
permanova_strata <- adonis2(Bray_dist ~ Genetics,
data = Data, permutations=999, method = "bray", strata = pseq_filtered@sam_data$Treatment)
permanova_strata
set.seed(4235421)
ord <- ordinate(pseq, "MDS", "bray")
#plot MDS/PcoA ----
plot_ordination(pseq, ord, color = "Treatment", shape = "Age") + geom_point(size = 4)
theme.marissa <- function() {
theme_classic(base_size = 14) +
theme(
panel.border = element_blank(),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text = element_text(size = 14),
axis.title = element_text(size = 16, face = "bold"),
legend.text = element_text(size = 16),
legend.title = element_text(size = 16, face = "bold"))
}
plot_ordination(pseq, ord, color = "Treatment", shape = "Age") + geom_point(size = 4) + theme_marissa()
plot_ordination(pseq, ord, color = "Treatment", shape = "Age") + geom_point(size = 4) + theme.marissa()
eigenvalues <- ord$values$Eigenvalues
eigenvalues <- eigenvalues^2
eigenvalues
eigenvalues <- ord$values$Eigenvalues
eigenvalues <- eigenvalues^2
plot_ordination(pseq, ord, type = "samples", axes = 3:4,
color = "Treatment", shape = "Age", label = NULL, title = NULL,
justDF = FALSE) + theme_classic() + geom_point(size = 4)
plot_ordination(pseq, ord, type = "samples", axes = 4:5,
color = "Treatment", shape = "Age", label = NULL, title = NULL,
justDF = FALSE) + theme_classic() + geom_point(size = 4)
plot_ordination(pseq, ord, type = "samples", axes = 5:6,
color = "Treatment", shape = "Age", label = NULL, title = NULL,
justDF = FALSE) + theme_classic() + geom_point(size = 4)
