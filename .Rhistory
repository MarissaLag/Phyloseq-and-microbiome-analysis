combined_plots <- grid.arrange(plot1, plot2, ncol = 1)
plot1 <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5))
plot2 <- ggplot(data = subset(Data, Treatment == "SW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "SW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5))
combined_plots <- grid.arrange(plot1, plot2, ncol = 1)
combined_plots <- grid.arrange(plot2, plot1, ncol = 1)
plot2 <- ggplot(data = subset(Data, Treatment == "SW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "SW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
x.lim(0, 90)
plot2 <- ggplot(data = subset(Data, Treatment == "SW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "SW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(0, 90)
combined_plots <- grid.arrange(plot2, plot1, ncol = 1)
plot1 <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(0, 90)
combined_plots <- grid.arrange(plot2, plot1, ncol = 1)
plot1 <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90)
plot1
plot2 <- ggplot(data = subset(Data, Treatment == "SW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "SW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90)
plot2
combined_plots <- grid.arrange(plot2, plot1, ncol = 1)
plot1 <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90) +
theme(panel.border = element_rect(color = "blue", fill = NA, size = 1))
plot1 <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90) +
theme(panel.border = element_rect(color = "blue", fill = NA, linewidth = 1))
plot1
plot1 <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90) +
theme(panel.border = element_rect(color = "blue", fill = NA, linewidth = 3))
plot1
plot1 <- ggplot(data = subset(Data, Treatment == "SW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90) +
theme(panel.border = element_rect(color = "blue", fill = NA, linewidth = 3))
plot1 <- ggplot(data = subset(Data, Treatment == "SW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90) +
theme(panel.border = element_rect(color = "blue", fill = NA, linewidth = 3))
plot1
plot1 <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90) +
theme(panel.border = element_rect(color = "red", fill = NA, linewidth = 3))
plot2 <- ggplot(data = subset(Data, Treatment == "SW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90) +
theme(panel.border = element_rect(color = "blue", fill = NA, linewidth = 3))
combined_plots <- grid.arrange(plot2, plot1, ncol = 1)
plot1 <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
xlim(55, 90) +
theme(panel.border = element_rect(color = "red", fill = NA, linewidth = 3)) +
guides(fill=FALSE)
combined_plots <- grid.arrange(plot2, plot1, ncol = 1)
filtered_data <- Data %>%
filter(Size < 75)
plot_filtered <- ggplot(data = filtered_data, Treatment =="DW"), aes(x = Size)) +
plot_filtered
plot_filtered <- ggplot(data = subset(filtered_data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal()
plot_filtered
filtered_data <- Data %>%
filter(Size < 73)
plot_filtered <- ggplot(data = subset(filtered_data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal()
plot_filtered
filtered_data
filtered_data <- Data %>%
filter(Size > 73)
# Create a density plot for the filtered data
plot_filtered <- ggplot(data = subset(filtered_data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal()
plot_filtered
# Create a density plot for the filtered data
plot_filtered <- ggplot(data = subset(filtered_data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal() +
xlim(55, 90)
plot_filtered
# Create a density plot for the filtered data
plot_filtered <- ggplot(data = subset(filtered_data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal() +
xlim(65, 90)
plot_filtered
plot_filtered <- ggplot(data = subset(Data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal() +
xlim(65, 90)
plot <- ggplot(data = subset(Data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal() +
xlim(65, 90)
plot
plot <- ggplot(data = subset(Data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal() +
xlim(50, 90)
plot <- ggplot(data = subset(Data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal() +
xlim(50, 90)
plot
plot_filtered <- ggplot(data = subset(filtered_data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "red", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal() +
xlim(50, 90)
plot_filtered
plot <- ggplot(data = subset(Data, Treatment =="DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75", x = "Size", y = "Density") +
theme_minimal() +
xlim(50, 90)
overlay_plot <- ggplot(combined_data, aes(x = Size, fill = Treatment, color = as.factor(Size < 75))) +
geom_density(alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75 Overlayed", x = "Size", y = "Density") +
theme_minimal() +
scale_color_manual(values = c("blue", "red")) +
scale_fill_manual(values = c("blue", "red")) +
xlim(50, 90)
combined_data <- rbind(subset(Data, Treatment == "DW" & Size < 75), subset(Data, Treatment == "DW"))
overlay_plot <- ggplot(combined_data, aes(x = Size, fill = Treatment, color = as.factor(Size < 75))) +
geom_density(alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75 Overlayed", x = "Size", y = "Density") +
theme_minimal() +
scale_color_manual(values = c("blue", "red")) +
scale_fill_manual(values = c("blue", "red")) +
xlim(50, 90)
overlay_plot
overlay_plot <- ggplot(combined_data, aes(x = Size, fill = Treatment, color = as.factor(Size < 75))) +
geom_density(alpha = 0.5) +
labs(title = "Density Plot of Sizes < 75 Overlayed", x = "Size", y = "Density") +
theme_minimal() +
scale_color_manual(values = c("blue", "red")) +
scale_fill_manual(values = c("red", "red")) +
xlim(50, 90)
overlay_plot
plot <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = cut(Size, c(-Inf, 73, Inf)))) +
geom_density(alpha = 0.5) +
labs(title = "Density Plot with Size < 75 Colored Red", x = "Size", y = "Density") +
theme_minimal() +
scale_fill_manual(values = c("blue", "red")) +
xlim(50, 90)
plot
plot <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size)) +
geom_density(aes(fill = ifelse(Size < 73, "< 73", ">= 73")), alpha = 0.5) +
labs(title = "Density Plot with Size < 73 Colored Red", x = "Size", y = "Density") +
theme_minimal() +
scale_fill_manual(values = c("red", "blue")) +
xlim(50, 90)
plot
plot <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size)) +
geom_density(fill = "blue", alpha = 0.5) +
labs(title = "Density Plot with Dotted Line at x = 73", x = "Size", y = "Density") +
theme_minimal() +
geom_vline(xintercept = 73, linetype = "dotted") +
xlim(50, 90)
plot
p <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal()
p
peaks <- Data %>%
filter(Treatment == "DW") %>%
group_by(Size_Category) %>%
summarise(peak_density = density(Size)$x[which.max(density(Size)$y)], .groups = "drop")
rlang::last_trace()
# Remove missing values and then calculate the peak density
peaks <- Data %>%
filter(!is.na(Size), Treatment == "DW") %>%
group_by(Size_Category) %>%
summarise(peak_density = density(Size)$x[which.max(density(Size)$y)], .groups = "drop")
p <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal()
p + annotate("segment", x = peaks$Size_category, xend = peaks$Size_category, y = 0, yend = peaks$density, linetype = "dotted")
# Create the density plot
p <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal()
# Extract the peak density values for each Size_Category
peaks <- peaks[complete.cases(peaks), ]  # Remove rows with NA values
peaks_summary <- peaks %>%
summarise(max_density = max(peak_density))
# Add the density plot with the segment marking the peak density for each Size_Category
p + geom_segment(data = peaks, aes(x = as.numeric(Size_Category), xend = as.numeric(Size_Category), y = 0, yend = peak_density), linetype = "dotted")
peaks
# Add annotated peak lines to the plot
p + geom_vline(xintercept = c(73.1, 76.1, 69.9), linetype = "dotted")
p <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_test(hjust = 0.5))
p <- ggplot(data = subset(Data, Treatment == "DW"), aes(x = Size, fill = Size_Category)) +
geom_density(alpha = 0.5) +
labs(title = "DW Treatment", x = "Size", y = "Density") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5))
# Add annotated peak lines to the plot
p + geom_vline(xintercept = c(73.1, 76.1, 69.9), linetype = "dotted")
library(lme4)
library(MASS)
setwd("/Users/maris/Documents/GitHub/Size_selection_OA/doi_10_5061_dryad_0gb5mkm3w__v20230307")
# read in data
sn=read.csv("size number tradeoffs.csv", header=T)
library(readr)
size_number_tradeoffs <- read_csv("size_number_tradeoffs.csv")
View(size_number_tradeoffs)
sn=read.csv("size number tradeoffs.csv", header=T)
sn<- size_number_tradeoffs
head(sn)
# convert egg diameter to volume using spherical approximation
eggvol=(4/3)*pi*(sn$mean.egg.diameter/2)^3
eggvol
# accounts for variation in reproductive effort among mothers by using maternal body
# mass, calendar month, and year as covariates
#########################################################################################
mm1=lmer(log(sn$no.eggs)~log(sn$Wt)+log(eggvol)+sn$Month+sn$Year+(1|sn$Block))
summary(mm1)
hist(resid(mm1), probability = T)
curve(dnorm(x,0, 0.3489), add=T) # residuals meet normal assumption reasonably well
qqnorm(resid(mm1))
qqline(resid(mm1))
plot(mm1)
View(sn)
mm1=lmer(log(sn$no.eggs)~log(sn$Wt))
mm1=lm(log(sn$no.eggs)~log(sn$Wt))
summary(mm1)
hist(resid(mm1), probability = T)
curve(dnorm(x,0, 0.3489), add=T) # residuals meet normal assumption reasonably well
qqnorm(resid(mm1))
qqline(resid(mm1))
plot(mm1)
mm1=lmer(log(sn$no.eggs)~log(sn$Wt)+log(eggvol)+sn$Month+sn$Year+(1|sn$Block))
summary(mm1)
hist(resid(mm1), probability = T)
curve(dnorm(x,0, 0.3489), add=T) # residuals meet normal assumption reasonably well
qqnorm(resid(mm1))
qqline(resid(mm1))
plot(mm1)
library(readr)
Larval_size_OA_and_mortality <- read_csv("Larval_size_OA_and_mortality.csv")
View(Larval_size_OA_and_mortality)
sm = Larval_size_OA_and_mortality
mm1rT=glmmPQL(Mortality~log(larval.vol)*month+pco2*temperature, random=~1|fam, family="quasipoisson", data=sm, na.action=na.exclude)
summary(mm1rT)
summary(mm1rT)
plot(mm1rT)
#########################################################################################
# plotting combined effects on fitness
cex.fig=1.4
pdf("Fig_1.pdf",         # File name
width = 7, height = 2.6, # Width and height in inches
bg = "white",          # Background color
colormodel = "cmyk",    # Color model (cmyk is required for most publications)
paper = "A4")
par(mfrow=c(1,3), mar=c(5,4,1,1))
pdf
a=exp(fixef(mm1)[1]+fixef(mm1)[3]*mean(log(eggvol))+fixef(mm1)[4]*5.75+fixef(mm1)[5]*0.5)
rf=sn$no.eggs/(a*sn$Wt^fixef(mm1)[2])
plot(eggvol,rf, xlab=expression(paste("Egg volume ", mm^3,)), ylab="Relative fecundity", pch=16, xlim=c(1.6,2.7))
curve((x/mean(eggvol))^fixef(mm1)[3],1.4,2.7, add=T, lwd=2)
text(1.63,2.3, "a)", cex=cex.fig)
plot(eggvol,rf, xlab=expression(paste("Egg volume ", mm^3,)), ylab="Relative fecundity", pch=16, xlim=c(1.6,2.7))
curve((x/mean(eggvol))^fixef(mm1)[3],1.4,2.7, add=T, lwd=2)
text(1.63,2.3, "a)", cex=cex.fig)
ggplot(eggvol,rf, xlab=expression(paste("Egg volume ", mm^3,)), ylab="Relative fecundity", pch=16, xlim=c(1.6,2.7))
plot(eggvol,rf, xlab=expression(paste("Egg volume ", mm^3,)), ylab="Relative fecundity", pch=16, xlim=c(1.6,2.7))
curve((x/mean(eggvol))^fixef(mm1)[3],1.4,2.7, add=T, lwd=2)
text(1.63,2.3, "a)", cex=cex.fig)
#Since no random effects will use lm
mm1=lm(log(sn$no.eggs)~log(sn$Wt))
a=exp(fixef(mm1)[1]+fixef(mm1)[3]*mean(log(eggvol))+fixef(mm1)[4]*5.75+fixef(mm1)[5]*0.5)
plot(eggvol,Wt, xlab=expression(paste("Egg volume ", mm^3,)), ylab="Relative fecundity", pch=16, xlim=c(1.6,2.7))
abline(mm1, col = "blue")
plot(log(sn$Wt), log(sn$no.eggs), xlab = "Log Weight of Adults", ylab = "Log Number of Eggs", main = "Relationship between Log Weight and Log Number of Eggs")
abline(mm1, col = "blue")
pco2=630 # based on experimental conditions, but close to ambient partial pressure of CO2 in waters
# within meters to 10's of meters of  shore in Southern California
foc.temp=20 # focal temperature
month=5.75 # calendar month (held constant for display)
Dur=14 # duration of experiments
plot(sm$larval.vol,exp(-sm$Mortality*Dur), xlab=expression(paste("Larval volume ", mm^3,)), ylab="Survival",
pch=ifelse(sm$treatment=="amb",1,17), col=ifelse(sm$treatment=="amb","blue","red"),
xlim=c(0.42,1.16))
text(0.435,0.85, "b)", cex=cex.fig)
survival.fxn=function(V){
mort=exp((fixef(mm1rT)[1]+fixef(mm1rT)[3]*month+fixef(mm1rT)[5]*foc.temp+
(fixef(mm1rT)[4] + fixef(mm1rT)[7]*foc.temp)*pco2+
(fixef(mm1rT)[2]+fixef(mm1rT)[6]*month)*log(V)))
exp(-mort*Dur)
}
curve(survival.fxn,.45,1.2, add=T, col="blue", lwd=2)
pco2=1650
foc.temp=23
curve(survival.fxn,.45,1.2, add=T, col="red", lwd=2)
legend(0.9,0.75, c("Ambient", expression("High CO"[2])), col=c("blue", "red"), pch=c(1,17),
lty=c(1,4), bty="n", cex=.8)
E<-3.86# starting volume of mass/energy to make offspring. Not derived
# empirically. This number was chosen so that maximum fitness was set to a value of 1
oss=-fixef(mm1)[3]
# accounts for variation in reproductive effort among mothers by using maternal body
# mass, calendar month, and year as covariates, block is random effect
#########################################################################################
mm1=lmer(log(sn$no.eggs)~log(sn$Wt)+log(eggvol)+sn$Month+sn$Year+(1|sn$Block))
E<-3.86# starting volume of mass/energy to make offspring. Not derived
# empirically. This number was chosen so that maximum fitness was set to a value of 1
oss=-fixef(mm1)[3]
lvev=0.416   # egg volume to larval volume scaling exponent
steep=2.317 # steepness parameter for egg volume as a power function of
# larval volume
Dur=25 # maximum duration of survival experiments. Effects of larval size
# and OA on mortality were still observed on day 25
pco2=630
foc.temp=20
RF<-function(V){
Ve=steep*V^lvev
mort=exp((fixef(mm1rT)[1]+fixef(mm1rT)[3]*month+fixef(mm1rT)[5]*foc.temp+
(fixef(mm1rT)[4] + fixef(mm1rT)[7]*foc.temp)*pco2+
(fixef(mm1rT)[2]+fixef(mm1rT)[6]*month)*log(V)))
exp(-mort*Dur)*(E/(Ve^oss))
}
curve(RF, .5,1, col="blue", lwd=2, xlab=expression(paste("Larval volume ", mm^3,)),
ylab="Relative Fitness", ylim=c(0.75,1))
peak=seq(0.5,0.8, by=0.01)[which.max(RF(seq(0.5,0.8, by=0.01)))]
lines(c(peak, peak),c(0, RF(peak)), lty=3, col="blue")
# high CO2
pco2=1650
foc.temp=23
curve(RF, .4,1, col="red", lwd=2, add=T)
peak=seq(0.5,0.9, by=0.01)[which.max(RF(seq(0.5,0.9, by=0.01)))]
lines(c(peak, peak),c(0, RF(peak)), lty=2, col="red")
text(0.52,0.96, "c)", cex=cex.fig)
dev.off()
curve(RF, .5,1, col="blue", lwd=2, xlab=expression(paste("Larval volume ", mm^3,)),
ylab="Relative Fitness", ylim=c(0.75,1))
peak=seq(0.5,0.8, by=0.01)[which.max(RF(seq(0.5,0.8, by=0.01)))]
lines(c(peak, peak),c(0, RF(peak)), lty=3, col="blue")
# high CO2
pco2=1650
foc.temp=23
curve(RF, .4,1, col="red", lwd=2, add=T)
peak=seq(0.5,0.9, by=0.01)[which.max(RF(seq(0.5,0.9, by=0.01)))]
lines(c(peak, peak),c(0, RF(peak)), lty=2, col="red")
text(0.52,0.96, "c)", cex=cex.fig)
pco2=630
foc.temp=20
RF<-function(V){
Ve=steep*V^lvev
mort=exp((fixef(mm1rT)[1]+fixef(mm1rT)[3]*month+fixef(mm1rT)[5]*foc.temp+
(fixef(mm1rT)[4] + fixef(mm1rT)[7]*foc.temp)*pco2+
(fixef(mm1rT)[2]+fixef(mm1rT)[6]*month)*log(V)))
exp(-mort*Dur)*(E/(Ve^oss))
}
curve(RF, .5,1, col="blue", lwd=2, xlab=expression(paste("Larval volume ", mm^3,)),
ylab="Relative Fitness", ylim=c(0.75,1))
peak=seq(0.5,0.8, by=0.01)[which.max(RF(seq(0.5,0.8, by=0.01)))]
lines(c(peak, peak),c(0, RF(peak)), lty=3, col="blue")
# high CO2
pco2=1650
foc.temp=23
curve(RF, .4,1, col="red", lwd=2, add=T)
peak=seq(0.5,0.9, by=0.01)[which.max(RF(seq(0.5,0.9, by=0.01)))]
lines(c(peak, peak),c(0, RF(peak)), lty=2, col="red")
text(0.52,0.96, "c)", cex=cex.fig)
dev.on()
curve(survival.fxn,.45,1.2, add=T, col="red", lwd=2)
legend(0.9,0.75, c("Ambient", expression("High CO"[2])), col=c("blue", "red"), pch=c(1,17),
lty=c(1,4), bty="n", cex=.8)
plot(sm$larval.vol,exp(-sm$Mortality*Dur), xlab=expression(paste("Larval volume ", mm^3,)), ylab="Survival",
pch=ifelse(sm$treatment=="amb",1,17), col=ifelse(sm$treatment=="amb","blue","red"),
xlim=c(0.42,1.16))
text(0.435,0.85, "b)", cex=cex.fig)
survival.fxn=function(V){
mort=exp((fixef(mm1rT)[1]+fixef(mm1rT)[3]*month+fixef(mm1rT)[5]*foc.temp+
(fixef(mm1rT)[4] + fixef(mm1rT)[7]*foc.temp)*pco2+
(fixef(mm1rT)[2]+fixef(mm1rT)[6]*month)*log(V)))
exp(-mort*Dur)
}
dev.set(dev.prev())
RF<-function(V){
Ve=steep*V^lvev
mort=exp((fixef(mm1rT)[1]+fixef(mm1rT)[3]*month+fixef(mm1rT)[5]*foc.temp+
(fixef(mm1rT)[4] + fixef(mm1rT)[7]*foc.temp)*pco2+
(fixef(mm1rT)[2]+fixef(mm1rT)[6]*month)*log(V)))
exp(-mort*Dur)*(E/(Ve^oss))
}
curve(RF, .5,1, col="blue", lwd=2, xlab=expression(paste("Larval volume ", mm^3,)),
ylab="Relative Fitness", ylim=c(0.75,1))
peak=seq(0.5,0.8, by=0.01)[which.max(RF(seq(0.5,0.8, by=0.01)))]
lines(c(peak, peak),c(0, RF(peak)), lty=3, col="blue")
# high CO2
pco2=1650
foc.temp=23
curve(RF, .4,1, col="red", lwd=2, add=T)
peak=seq(0.5,0.9, by=0.01)[which.max(RF(seq(0.5,0.9, by=0.01)))]
lines(c(peak, peak),c(0, RF(peak)), lty=2, col="red")
text(0.52,0.96, "c)", cex=cex.fig)
Data = X60_fert_Phenotype_Data_CSV
Data
avg_data_scores_DW <- Data %>%
filter(Treatment == "DW") %>%
group_by(Size_Score) %>%
summarise(
Avg_Size = mean(Size),
SD_Size = sd(Size),
.groups = 'drop'
)
avg_data_scores_DW <- Data %>%
filter(Treatment == "DW") %>%
group_by(Score) %>%
summarise(
Avg_Size = mean(Size),
SD_Size = sd(Size),
.groups = 'drop'
)
avg_data_scores_DW
View(Data)
setwd("/Users/maris/Documents/GitHub/Phyloseq and microbiome analysis")
Marissa_mb2021_filtered_20240203 <- readRDS("~/Documents/GitHub/Phyloseq and microbiome analysis/Marissa_mb2021_filtered_20240203.rds")
pseq <- Marissa_mb2021_filtered_20240203
View(pseq@tax_table)
View(pseq@sam_table)
View(pseq@otu_table)
View(pseq@sam_data)
# check if any OTUs are not present in any samples (want false)
any(taxa_sums(pseq) == 0)
sample_depths <- sample_sums(pseq)
print(sample_depths)
set.seed(4235421)
ord <- ordinate(pseq, "MDS", "bray")
plot_ordination(ps1, ord, color = "Treatment", shape = "Age") + geom_point(size = 4)
p <- plot_ordination(pseq, ord, color = "Factor") + geom_point(size = 4)
library("devtools")
library(phyloseq)
library(microbiome)
p <- plot_ordination(pseq, ord, color = "Factor") + geom_point(size = 4)
plot_ordination(ps1, ord, color = "Treatment", shape = "Age") + geom_point(size = 4)
plot_ordination(pseq, ord, color = "Treatment", shape = "Age") + geom_point(size = 4)
